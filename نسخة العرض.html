<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>عرض الورش التدريبية - قراءة فقط</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
h1 { text-align: center; }
.card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
table, th, td { border: 1px solid #ccc; }
th, td { padding: 10px; text-align: center; }
input { padding: 8px; border-radius: 8px; border: 1px solid #aaa; width: 100%; box-sizing: border-box }
button { padding: 8px 14px; border: none; border-radius: 8px; background: #007bff; color: white; cursor: pointer; margin: 5px; }
button:hover { background: #0056b3; }
ul { text-align: right; padding-right: 10px; margin:0; }
</style>
</head>
<body>

<h1>عرض الورش التدريبية - قراءة فقط</h1>

<div class="card">
<h2>بحث الموظفين</h2>
<input type="text" id="searchInput" placeholder="أدخل اسم الموظف للبحث" oninput="renderFiltered()" />
</div>

<div class="card">
<button onclick="exportToExcel()">تصدير البيانات إلى Excel</button>
<h2>قائمة الموظفين</h2>
<table>
  <thead>
    <tr>
      <th>الاسم</th>
      <th>عدد الورش</th>
      <th>تفاصيل الورش</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>
</div>

<script>
let employees = [];

// تحميل البيانات من LocalStorage
function loadLocal() {
  const data = localStorage.getItem("employees");
  if (data) employees = JSON.parse(data);
  renderFiltered();
}

// عرض البيانات حسب البحث
function renderFiltered() {
  const query = document.getElementById("searchInput").value.trim().toLowerCase();
  const tableBody = document.getElementById("tableBody");
  tableBody.innerHTML = "";

  employees.forEach(emp => {
    if (emp.name.toLowerCase().includes(query)) {
      let list = "<ul>";
      emp.workshops.forEach(w => list += `<li>${w.name} — ${w.start} إلى ${w.end}</li>`);
      list += "</ul>";
      tableBody.innerHTML += `<tr>
        <td>${emp.name}</td>
        <td>${emp.workshops.length}</td>
        <td>${list}</td>
      </tr>`;
    }
  });
}

// تصدير البيانات إلى Excel
function exportToExcel() {
  const worksheetData = [];
  employees.forEach(emp => {
    if (!emp.workshops || emp.workshops.length === 0) {
      worksheetData.push({ "اسم الموظف": emp.name, "اسم الورشة": "", "تاريخ البداية": "", "تاريخ النهاية": "" });
    } else {
      emp.workshops.forEach(w => worksheetData.push({
        "اسم الموظف": emp.name,
        "اسم الورشة": w.name,
        "تاريخ البداية": w.start,
        "تاريخ النهاية": w.end
      }));
    }
  });
  const worksheet = XLSX.utils.json_to_sheet(worksheetData);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, "الورش");
  XLSX.writeFile(workbook, "training_data.xlsx");
}

// تحميل البيانات عند فتح الصفحة
loadLocal();
</script>

</body>
</html>
